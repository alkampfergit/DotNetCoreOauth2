@*
    MSAL-based OAuth2 IMAP/SMTP testing page
*@
<style>
  pre {
    white-space: pre-wrap;       /* Since CSS 2.1 */
    white-space: -moz-pre-wrap;  /* For Mozilla */
    white-space: -pre-wrap;      /* For Opera 4-6 */
    white-space: -o-pre-wrap;    /* For Opera 7 */
    word-wrap: break-word;       /* For Internet Explorer 5.5+ */
    max-width: 100%;             /* Specify a max-width if necessary */
  }
  .msal-section {
    border: 2px solid #0078d4;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
    background-color: #f8f9fa;
  }
  .msal-header {
    color: #0078d4;
    font-weight: bold;
    margin-bottom: 15px;
  }
</style>
@model WebAppTest.Controllers.Models.MSALIMAPModel

<div class="msal-section">
    <h1 class="msal-header">üîê MSAL-based OAuth2 IMAP/SMTP Testing</h1>
    <p><em>This page demonstrates OAuth2 authentication using Microsoft Authentication Library (MSAL)</em></p>
</div>

@{
    @if (String.IsNullOrEmpty(Model.AccessToken))
    {
        <div class="msal-section">
            <h2 class="msal-header">IMAP with Client Credentials Flow (MSAL)</h2>
            <form action="/msal-oauth2/imap-client-flow" method="post">
                <label for="email">Email address:</label>
                <input type="text" id="email" name="email" />
                <input type="submit" value="Generate IMAP Client Credentials Flow (MSAL)" />
            </form>
        </div>

        <div class="msal-section">
            <h2 class="msal-header">SMTP with Client Credentials Flow (MSAL)</h2>
            <form action="/msal-oauth2/smtp-client-flow" method="post">
                <label for="from">From Email address:</label>
                <input type="text" id="from" name="from" />
                
                <label for="to">To Email address:</label>
                <input type="text" id="to" name="to" />
                <input type="submit" value="Send mail with SMTP and Client Credentials Flow (MSAL)" />
            </form>
        </div>

        <div class="msal-section">
            <h2 class="msal-header">IMAP with Authorization Code Flow (MSAL)</h2>
            <form action="/msal-oauth2/code-flow" method="post">
                <label for="scope">Scope:</label>
                <input style="width: 800px" type="text" id="scope" name="scope" value="openid email offline_access https://outlook.office.com/IMAP.AccessAsUser.All https://outlook.office.com/SMTP.Send" />
                <input type="submit" value="Generate Authorization Code Flow Link (MSAL)" />
            </form>
        </div>
    }

    @if (!String.IsNullOrEmpty(Model.AccessToken))
    {
        <div class="msal-section">
            <h1 class="msal-header">üß™ TEST Actual Token (MSAL)</h1>
            <form action="/msal-oauth2/test-imap" method="post">
                <input type="hidden" name="state" id="state" value="@Model.State" />
                <input type="submit" value="Test IMAP Connection (MSAL)" />
            </form>
            <br />
            <form action="/msal-oauth2/test-smtp" method="post">
                <input type="hidden" name="state" id="state2" value="@Model.State" />
                <label for="to">To Email address:</label>
                <input type="text" id="to" name="to" />
                <input type="submit" value="Send mail with SMTP and actual token (MSAL)" />
            </form>
        </div>
    }

    @if (!String.IsNullOrEmpty(Model.TestResult))
    {
        <div class="msal-section">
            <h2 class="msal-header">üìã Result of accessing IMAP/SMTP with MSAL XOAUTH2</h2>
            <p><strong>Email:</strong> @Model.EmailAddress</p>
            <p><strong>Result:</strong> @Model.TestResult</p>
        </div>
    }

    @if (!String.IsNullOrEmpty(Model.LoginLink))
    {
        <div class="msal-section">
            <h3 class="msal-header">üîó MSAL Login Link</h3>
            <a href="@Model.LoginLink" target="_blank">@Model.LoginLink</a>
            <h3 class="msal-header">üêõ Debug Login Link</h3>
            <pre>@Model.DebugLoginLink</pre>
        </div>
    }

    @if (!String.IsNullOrEmpty(Model.AccessToken))
    {
        <div class="msal-section">
            <h3 class="msal-header">üì• MSAL IDP Response</h3>
            <pre>@Model.IdpResponseLink</pre>
            
            <h3 class="msal-header">üé´ Token Request (MSAL)</h3>
            <pre>@Model.RequestTokenData</pre>
            
            @if (!String.IsNullOrEmpty(Model.IdToken))
            {
                <h3 class="msal-header">üÜî ID Token</h3>
                <pre>@Model.IdToken</pre>
            }
            
            <h3 class="msal-header">üîë Access Token</h3>
            <pre>@Model.AccessToken</pre>
            
            @if (!String.IsNullOrEmpty(Model.RefreshToken))
            {
                <h3 class="msal-header">üîÑ Refresh Token</h3>
                <pre>@Model.RefreshToken</pre>
            }
        </div>
    }
}